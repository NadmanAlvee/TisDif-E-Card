<%- include('./partials/headers/headerExt.ejs') %>

  <main class="product-details">
    
    <div class="product-main">
        <div class="product-images">
          <img id="main-image" src="<%= (Array.isArray(product.image) && product.image.length > 0 && product.image[0]) ? product.image[0] : '/images/placeholder.webp' %>" alt="Product Image">
          <div class="image-thumbnails">
            <% if (Array.isArray(product.image) && product.image.length > 0 && product.image != "") { %>
              <% product.image.forEach(image => { %>
                <img class="thumbnail" src="<%= image %>" onclick="updateMainImage(this)">
              <% }) %>
            <% } else { %>
              <img class="thumbnail" src="/images/placeholder.webp">
            <% } %>
          </div>
        </div>
    
      <% if (product.category == 'giftcards') { %>
        <%- include('./partials/giftcards.ejs') %>
      <% } else if (product.category == 'iphones') { %>
        <%- include('./partials/iphones.ejs') %>
      <% } else if (product.category == 'accessories') { %>
        <%- include('./partials/accessories.ejs') %>
      <% } %>
    </div>

    <!-- Related Products -->
    <div class="related-products">
      <h3>Related Products</h3>
      <div class="related-products-container">
        <% relatedProducts.forEach(related => { %>
          <div class="related-product-card">
            <a href="/product/<%= related._id %>">
              <img src="<%= (related.image && related.image.length > 0) ? related.image[0] : '/images/placeholder.webp' %>" alt="<%= related.name %>">
              <p><%= related.name %></p>  
              <% if (related.stock === 0) { %>
                <p>Out Of Stock</p>
              <% } else { %>
                <p>Price: <%= related.price.toFixed(2) %> BDT</p>
              <% } %>
            </a>
          </div>
        <% }) %>
      </div>
    </div>
  </main>
<link rel="stylesheet" href="/css/productDetails.css" />
<script src="/scripts/addToCart.js" defer></script>
<script src="/scripts/product-details.js" defer></script>
</body>
</html>
