<%- include('./partials/headers/headerExt.ejs') %>
<link rel="stylesheet" href="/css/productDetails.css" />
  <main class="product-details">
    <div class="product-main sections">
      <div class="product-images">
        <img id="main-image" src="<%= (Array.isArray(product.image) && product.image.length > 0 && product.image[0]) ? product.image[0] : '/images/placeholder.webp' %>" alt="Product Image">
      </div>
      <div class="product-div">
        <% if (product.category == 'giftcards') { %>
          <%- include('./partials/giftcards.ejs') %>
        <% } else if (product.category == 'iphones') { %>
          <%- include('./partials/iphones.ejs') %>
        <% } else if (product.category == 'accessories') { %>
          <%- include('./partials/accessories.ejs') %>
        <% } %>
        <div class="actions">
          <% if (product.stock > 0) { %>
              <button class="add-to-cart" data-id="<%= product._id %>">ADD TO CART</button>
              <button class="buy-now add-to-cart" data-id="<%= product._id %>">Buy Now</button>
          <% } else { %>
              <button class="empty-stock">ADD TO CART</button>
              <button class="empty-stock">Buy Now</button>
          <% } %>
        </div>
      </div>
    </div>
    <% const RelatedProducts = relatedProducts.filter(Product => Product.category === product.category);
    if(RelatedProducts.length > 0) { %>
    <section class="related-container sections">
        <div class="related-text slide-in">
          <h2>Browse</h2>
          <h2>Similar</h2>
          <h2>Products</h2>
        </div>
        <div class="related-product-card">
          <% relatedProducts.forEach(related => { %>
              <a href="/product/<%= related._id %>">
                  <div class="related-card slide-in <%= related.stock === 0 ? 'out-of-stock' : '' %>">
                      <img class="main-image"
                          src="<%= (related.image && related.image.length && related.image[0]) ? related.image[0] : '/images/placeholder.webp' %>"
                          alt="<%= related.name %>" />
                      <h3 class="related-name"><%= related.name %></h3>
                      <% if (related.stock === 0) { %>
                          <p class="related-price">Out Of Stock</p>
                      <% } else { %>
                          <p class="related-price"><%= related.price.toFixed(2).toLocaleString() %> BDT</p>
                      <% } %>
                  </div>
              </a>  
          <% }) %>
        </div>
    </section>
    <% } %>
  </main>
<script src="/scripts/addToCart.js" defer></script>
<script src="/scripts/product-details.js" defer></script>
</body>
</html>
