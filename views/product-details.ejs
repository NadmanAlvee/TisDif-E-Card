<%- include('./partials/headerExt.ejs') %>

  <main class="product-details">
    
    <div class="product-main">
      <div class="product-images">
        <img id="main-image" src="<%= (Array.isArray(product.image) && product.image.length > 0 && product.image[0]) ? product.image[0] : '/images/placeholder.jpg' %>" alt="Product Image">
        
        <div class="image-thumbnails">
          <% if (Array.isArray(product.image) && product.image.length > 0 && product.image != "") { %>
            <% product.image.forEach(image => { %>
              <img class="thumbnail" src="<%= image %>" onclick="updateMainImage(this)">
            <% }) %>
          <% } else { %>
            <img class="thumbnail" src="/images/placeholder.jpg">
          <% } %>
        </div>          
      </div>
    
      <% if (product.category == 'giftcards') { %>
        <%- include('./partials/giftcards.ejs') %>
      <% } else if (product.category == 'iphones') { %>
        <%- include('./partials/iphones.ejs') %>
      <% } else if (product.category == 'accessories') { %>
        <%- include('./partials/accessories.ejs') %>
      <% } %>
    </div>

    <!-- Related Products -->
    <div class="related-products">
      <h3>Related Products</h3>
      <div class="related-products-container">
        <% relatedProducts.forEach(related => { %>
          <div class="related-product-card">
            <a href="/product/<%= related._id %>">
              <img src="<%= (related.image && related.image.length > 0) ? related.image[0] : '/images/placeholder.jpg' %>" alt="<%= related.name %>">
              <p><%= related.name %></p>
              <p>Price: <%= related.price.toFixed(2) %> BDT</p>
            </a>
          </div>
        <% }) %>
      </div>
    </div>
  </main>
<link rel="stylesheet" href="/css/productDetails.css" />
<script src="/scripts/index.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const pricePerUnit = "<%= product.price %>";
    const quantityEl = document.getElementById("quantity");
    const totalPriceEl = document.getElementById("total-price");
    const decreaseBtn = document.getElementById("decrease-qty");
    const increaseBtn = document.getElementById("increase-qty");

    let quantity = 1;

    function updatePrice() {
        totalPriceEl.textContent = `${(pricePerUnit * quantity).toFixed(2)} BDT`;
    }

    increaseBtn.addEventListener("click", function () {
        quantity++;
        quantityEl.textContent = quantity;
        updatePrice();
    });

    decreaseBtn.addEventListener("click", function () {
        if (quantity > 1) {
            quantity--;
            quantityEl.textContent = quantity;
            updatePrice();
        }
    });
  });
  function updateMainImage(thumbnail) {
    document.getElementById("main-image").src = thumbnail.src;
  }
  function getLogin() {
      window.location.href = "/login";
  }
</script>
</body>
</html>
